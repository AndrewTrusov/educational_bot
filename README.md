

# Telegram Bot: AI-Powered Educational Assistant

## Описание проекта

Данный проект представляет собой серверное решение для Telegram-бота, предназначенного для выдачи образовательных задач и автоматической проверки ответов пользователей с использованием ИИ. Архитектура построена на базе бессерверных вычислений.

## Архитектура решения

Система реализует асинхронную обработку для разделения логики взаимодействия с пользователем и ресурсоемкой проверки ответов.

**Структура состоит из 4 ключевых компонентов:**

1.  **Serverless Function 1 (Frontend/API Handler)**: Синхронная функция, выступающая в роли вебхука для Telegram. Отвечает за мгновенную реакцию на команды пользователя.
2.  **Serverless Function 2 (Async Worker)**: Асинхронная функция-воркер, запускаемая по триггеру. Отвечает за проверку ответов через LLM.
3.  **Database (Supabase)**: Единое хранилище данных (PostgreSQL) для пользователей, задач, истории попыток и очереди обработки.
4.  **External APIs**: Интеграция с **Telegram Bot API** и **Mistral API** (AI проверка).

### Схема потока данных
1.  Пользователь отправляет решение в Telegram → `handler.py` принимает запрос.
2.  `handler.py` сохраняет ответ в таблицу в Supabase.
3.  `worker.py` забирает задачи из очереди.
4.  `worker.py` отправляет ответ в Mistral AI для оценки, сохраняет результат и уведомляет пользователя.

***

## Описание файлов

### 1. `handler.py` (Bot Logic & Webhook)
Основной файл логики взаимодействия с пользователем.
*   **Роль**: Обработка входящих обновлений от Telegram (команды, нажатия кнопок).
*   **Функционал**:
    *   Регистрация и проверка баланса пользователей (`get_or_create_user`).
    *   Управление состоянием диалога (FSM) через `user_states`.
    *   Выдача случайных задач с фильтрацией по категориям (`get_random_task`).
    *   **Ключевая особенность**: Не проверяет ответ сразу, а ставит его в очередь через `add_to_processing_queue`, обеспечивая быстрый отклик интерфейса.

### 2. `worker.py`
Фоновый обработчик (Worker)
*   **Роль**: Асинхронная проверка решений из очереди.
*   **Функционал**:
    *   Считывает пакет задач (batch size: 5) со статусом `pending` из Supabase.
    *   Формирует промпт для **Mistral AI**, включающий текст задачи, эталонный ответ и ответ ученика.
    *   Парсит полученный от ИИ балл.
    *   Сохраняет результат в таблицу и обновляет статус очереди.
    *   Отправляет пользователю уведомление с результатом проверки и комментарием ИИ.

***

## Технический стек

*   **Runtime**: Python 3.x
*   **Cloud Provider**: Yandex Cloud Functions
*   **Database**: Supabase (PostgreSQL + REST API)
*   **AI Model**: Mistral AI (via API)
*   **Dependencies**: `requests`, `mistralai`

## Установка и Деплой

1.  **Переменные окружения**:
    Убедитесь, что заданы следующие переменные:
    *   `TELEGRAM_BOT_TOKEN`: Токен вашего бота.
    *   `SUPABASE_URL` / `SUPABASE_KEY`: Доступы к базе данных.
    *   `MISTRAL_API_KEY`: Ключ API для проверки ответов (только для воркера).
    *   `MISTRAL_AGENT_ID`: ID агента Mistral (опционально).


2.  **Деплой**:
    *   `handler.py` деплоится как функция с HTTP-триггером (Webhook).
    *   `worker.py` деплоится как функция с триггером по таймеру (CRON) или событию добавления в БД.
